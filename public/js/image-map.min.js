$(document).ready(function(){function a(a){var b=f(i,a);null==g?(g=b.x,h=b.y):(l.push({x:g,y:h,w:b.x-g,h:b.y-h}),g=null,h=null,$("#zones-list").append("<div class='row collapse zone'><div class='small-3 columns'><span class='postfix'>Nom de la zone</span></div> <div class='small-7 columns'><input type='text' name='txtZoneName[]'></div><input type='hidden' name='zoneId' value="+(l.length-1)+"><div class='small-2 columns'><a href='#' class='button postfix deleteZone'>Supprimer</a></div></div>"))}function b(a){if(null!=g){c(),j.beginPath(),j.strokeStyle="#FF0000",j.lineWidth=2,d();var b=f(i,a);j.rect(g,h,b.x-g,b.y-h),j.stroke()}}function c(){j.clearRect(0,0,i.width,i.height)}function d(){j.drawImage(k,0,0,i.width,i.height)}function e(){$("input[name=zoneId]").each(function(a){$(this).val(a)})}function f(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}var g,h,i=document.getElementById("zone-maker"),j=i.getContext("2d"),k=new Image,l=[];k.onload=function(){d()},k.src="./image-test.jpg",i.addEventListener("mousedown",a,!1),i.addEventListener("mousemove",b,!1),$("#zones-list").on("click",".deleteZone",function(){l.splice($(this).parent().prev().val(),1),c(),d(),$(this).parent().parent().remove(),e()}),$("#zones-list").on("focus","input[type=text]",function(){var a=$(this).parent().next().val();c(),j.beginPath(),j.strokeStyle="#FF0000",j.lineWidth=2,j.rect(l[a].x,l[a].y,l[a].w,l[a].h),d(),j.stroke()})});