$.getScript("config.min.js"), $(document).foundation(), $(document).foundation("abide", "events");
var stopClickPropagation = !1;
$(document).ready(function() {
    /* Supprimer un usager */
    $("#tableBody, #mobileTable").on("click", "[id*='btnDelete']", function() {
        var a = ($(this).attr("id").replace(/[^0-9]/g, ""), $(this).closest("tr").children("td").eq(1).text());
        $("#deleteWarning p:first").data("btnRef", $(this).attr("id")), $("#deleteWarning p:first").html("Vous vous apprétez à supprimer <strong>" + a + "</strong>. Voulez vous continuer?"), $("#deleteWarning").foundation("reveal", "open")
    }), 
    /* Modifier un Usager */
    $("#tableBody, #mobileTable").on("click", "[id*='btnEdit']", function() {
        var a = $(this).attr("id").replace(/[^0-9]/g, "");
        $.post(SERVER_ABSOLUTE_PATH + "/moderation/getFamilyMember", {
            familyMemberId: a
        }, 
        function(a) {
            var b = JSON.parse(a);
            $("input[name='txtEditUserName']").val(b.UserName), $("input[name='txtEditFirstName']").val(b.UserInfoFirstName), $("input[name='txtEditLastName']").val(b.UserInfoLastName), $("input[name='txtEditPhone']").val(b.UserInfoTel), $("input[type='hidden']").val(b.UserId)
        }), 
        $("#editModal").foundation("reveal", "open")
    }), 
    /* BOUTON D'ACTIVATION !!!! */
    $("#tableBody, #mobileTable").on("click", "[id*='chkActivation'], [id*='smallChkActivation']", function() {
        var a = $(this).attr("id").replace(/[^0-9]/g, ""),
            b = SERVER_ABSOLUTE_PATH + "/moderation/setFamilyModActivation"; - 1 != $(this).attr("id").search("smallChkActivation") ? ($.post(b, {
            id: a
        }), 
            $("#chkActivation" + a).click()) : $("#smallChkActivation" + a).click()
    }), 
    $("#searchInput").on("keyup", function() {
        var a = $(this).val();
        "" != a ? ($("#mobileTable > li").show(), $("#mobileTable > li:not(:contains('" + a + "'))").hide(), $("#tableBody > tr").show(), $("#tableBody > tr:not(:contains('" + a + "'))").hide()) : ($("#mobileTable > li").show(), $("#tableBody > tr").show())
    })
}), 
$("#btnModalDelete").click(function() {
    var a = SERVER_ABSOLUTE_PATH + "/moderation/deleteFamilyMember",
        b = $("#deleteWarning p:first").data("btnRef").replace(/[^0-9]/g, "");
    $.post(a, {
        id: b
    }, 
    function() {
        $("#" + $("#deleteWarning p:first").data("btnRef")).closest("tr").remove();
        var a = "btnDelete" + b;
        $("[id='+btn+']").closest("tr").remove(), $("#" + a).closest("li.familyMemberRow").remove()
    }), 
    $("#deleteWarning").foundation("reveal", "close")
}), 
$(".btnModalCancel").click(function() {
    $("#deleteWarning").foundation("reveal", "close")
}), 
$("#btnAdd").click(function() {
    $("#addModal").foundation("reveal", "open")
}), 
/* Ajouter des User pour L'affichage  après l'ajout */
$("#frmAddUser").on("valid", function() {
    var a = SERVER_ABSOLUTE_PATH + "/moderation/addFamilyMember";
    $.post(a, {
        UserName: $("#addUserName").val(),
        UserPass: $("#addPassword").val(),
        UserInfoFirstName: $("#addFirstName").val(),
        UserInfoLastName: $("#addLastName").val(),
        UserInfoTel: $("#addPhoneNumber").val()
    }, 
    function(a) {
        var b = JSON.parse(a),
            c = 1 == b.UserInfoIsMod ? "checked" : "";
        $("#tableBody").append("<tr><td><a href='mailto:" + b.UserName + "' class='nameFixedWidth'>" + b.UserName + "</a></td><td>" + b.UserInfoFirstName + " " + b.UserInfoLastName + "</td><td><a href='tel:" + b.UserInfoTel + "'>" + b.UserInfoTel + "</a></td><td>" + (b.UserId == b.UserInfoFamilyOwner ? "Administrateur" : "<div class='switch tiny'><input id='chkActivation" + b.UserId + "'" + c + "type='checkbox'><label for='chkActivation" + b.UserId + "'></label></div>") + "</td><td>" + (b.UserId == b.UserInfoFamilyOwner ? "" : "<ul class='button-group radius'><li><a id='btnEdit" + b.UserId + "' href='#' class='small button'><i class='fa fa-pencil fa-lg'></i></a></li><li><a id='btnDelete" + b.UserId + "' href='#' class='small button'><i class='fa fa-trash-o fa-lg'></i></a></li></ul>") + "</td></tr>"), $("#mobileTable").append("<li class='familyMemberRow'><ul class='vcard show-for-small-only'><li class='fn'>" + b.UserInfoFirstName + " " + b.UserInfoLastName + "</li><li class='Mail'>" + b.UserName + "</li><li>" + b.UserInfoTel + "</li><li><div class='switch tiny'><input id='smallChkActivation" + b.UserId + "'" + c + "  type='checkbox'><label for='smallChkActivation" + b.UserId + "'></label></div></li><li>" + (b.UserId == b.UserInfoFamilyOwner ? "" : "<ul class='button-group radius'><li><a id='btnEdit" + b.UserId + "' href='#' class='small button'><i class='fa fa-pencil fa-lg'></i></a></li><li><a id='btnDelete" + b.UserId + "' href='#' class='small button'><i class='fa fa-trash-o fa-lg'></i></a></li></ul>") + "</li></ul></li>"), $("input").val("")
    }), 
$("#deleteWarning").foundation("reveal", "close")
}), 
$("#frmEditUser").on("valid", function() {
    event.preventDefault(), userId = $("#UserId").val(), $.post(SERVER_ABSOLUTE_PATH + "/moderation/editFamilyMember", {
        UserId: userId,
        UserName: $("input[name='txtEditUserName']").val(),
        UserInfoFirstName: $("input[name='txtEditFirstName']").val(),
        UserInfoLastName: $("input[name='txtEditLastName']").val(),
        UserInfoTel: $("input[name='txtEditPhone']").val()
    }, 
    function(a) {
        var b = "btnDelete" + userId;
        $("#" + b).closest("tr").remove(), $("#" + b).closest("li.familyMemberRow").remove();
        var c = JSON.parse(a),
            d = 1 == c.UserInfoIsMod ? "checked" : "";
        $("#tableBody").append("<tr><td><a href='mailto:" + c.UserName + "' class='nameFixedWidth'>" + c.UserName + "</a></td><td>" + c.UserInfoFirstName + " " + c.UserInfoLastName + "</td><td><a href='tel:" + c.UserInfoTel + "'>" + c.UserInfoTel + "</a></td><td>" + (c.UserId == c.UserInfoFamilyOwner ? "Administrateur" : "<div class='switch tiny'><input id='chkActivation" + c.UserId + "'" + d + " type='checkbox'><label for='chkActivation" + c.UserId + "'></label></div>") + "</td><td>" + (c.UserId == c.UserInfoFamilyOwner ? "" : "<ul class='button-group radius'><li><a id='btnEdit" + c.UserId + "' href='#' class='small button'><i class='fa fa-pencil fa-lg'></i></a></li><li><a id='btnDelete" + c.UserId + "' href='#' class='small button'><i class='fa fa-trash-o fa-lg'></i></a></li></ul>") + "</td></tr>"), $("#mobileTable").append("<li class='familyMemberRow'><ul class='vcard show-for-small-only'><li class='fn'>" + c.UserInfoFirstName + " " + c.UserInfoLastName + "</li><li class='Mail'>" + c.UserName + "</li><li>" + c.UserInfoTel + "</li><li><div class='switch tiny'><input id='smallChkActivation" + c.UserId + "'" + d + "  type='checkbox'><label for='smallChkActivation" + c.UserId + "'></label></div></li><li>" + (c.UserId == c.UserInfoFamilyOwner ? "" : "<ul class='button-group radius'><li><a id='btnEdit" + c.UserId + "' href='#' class='small button'><i class='fa fa-pencil fa-lg'></i></a></li><li><a id='btnDelete" + c.UserId + "' href='#' class='small button'><i class='fa fa-trash-o fa-lg'></i></a></li></ul>") + "</li></ul></li>"), $("#editModal").foundation("reveal", "close")
    })
});